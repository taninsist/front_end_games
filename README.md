# tetris 俄罗斯方块

> webpack + TS

环境：浏览器 + 模块化

webpakc:构建工具，根据入口文件寻找依赖，打包

# 工程搭建

1. 安装 `webpack` , 配置 `webpack.config.js`, 测试打包命令 `webpack --mode=production`

2. 安装 `html-webpack-plugin`  打包 html

3. 安装 `clean-webpack-plugin` 打包之前清空输出目录

4. 安装 `webpack-dev-server`

5. 安装`ts`的相应loader -> `ts-loader`(官方) or `awsome-typescript-loader`(民间) 
 - 它们依赖 `typescript`

# 游戏开发

单一职能原则：每个类只做更它相关的事
开闭原则：系统中的类，应该对扩展开发，对修改关闭

基于以上两个原则，系统中使用如下模式：
数据-界面分离模式
1. 所有的属性全部私有化
2. 使用公共的方法提供对属性的访问


# 开发方块的组合类

组合类中的属性：
- 小方块的组数
思考：该数组的组成不能发生变化

回答：不能发送变化，是只读数组

思考： 该数组的每一项从何而来

一个方块的组合，取决于组合的形状(一组相对坐标的组合，该组合中有一个特殊坐标，表示形状的中心)

如果知道，形状，中心点坐标，颜色，就可以设置小方块



# 俄罗斯的规则类

# 开发旋转功能

旋转的本质：根据当前形状 -> 新的形状

## 分析
> 下面坐标都指的是逻辑坐标，即相对中心的的坐标，'$'为逻辑中心点

形状如下：

```js
//顺势针旋转
  A    旋转后    B
B $    =>      C $ A  
  C
```

对应逻辑点:
```ts
            {x:0,y:-1}                  {x:0,y:-1}
{x:-1,y:0}  {x:0,y:0}   =>  {x:-1,y:0}  {x:0,y:0}   {x:1,y:0}
            {x:0,y:1}
```

```ts

旋转前的坐标：   旋转后的坐标
A: 0, -1    =>      1, 0
B: -1, 0    =>      0, -1
C: 0, 1     =>      -1, 0 
```    

> 规律： (x, y)  旋转后=> (-y, x) 

**逆时针旋转**
```ts
A: 1, 0     =>      0, -1
B: 0, -1    =>      -1, 0
C: -1, 0    =>      0, 1
```
> 规律：(x,y)   =>  (y,-x) 







# 开发游戏类

Game类清楚什么时候进行显示的切换，但不知道如何显示

什么时候可能发生触底：什么时候调用函数

1. 自动下落
2. 玩家控制下落

触底之后做什么？（函数如何编写的问题）

- 切换方块
- 保证已拉落下的方块

新的问题？
1. 当触底后，如何保存已落下的方块？
2. 如何根据已保存的方块，判断当前是否可以移动